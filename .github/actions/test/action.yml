name: "test"
description: "build and test the repository"

runs:
  using: "composite"
  steps:
    # checkout the repo
    - uses: actions/checkout@v2
    - name: fetch tags
      run: git fetch --prune --unshallow --tags
      shell: bash
    - name: environment dump
      run: |
        python3 --version
        git --version
        git describe --tags
      shell: bash
    - name: install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg
        sudo python3 -m pip install --upgrade build twine
      shell: bash
    - name: build
      run: python3 -m build
      shell: bash
    - name: install
      run: sudo python3 -m pip install dist/*.whl
      shell: bash
    - name: test
      run: python3 -m unittest
      shell: bash

